proxy:
  # see https://zero-to-jupyterhub.readthedocs.io/en/latest/setup-jupyterhub/setup-jupyterhub.html
  secretToken: <HEXA_NOTEBOOKS_PROXY_SECRET_TOKEN>  # can be generated with "openssl rand -hex 32"
  # see https://zero-to-jupyterhub.readthedocs.io/en/latest/administrator/security.html?highlight=letsencrypt#set-up-automatic-https
  https:
    enabled: true
    hosts:
      - <HEXA_NOTEBOOKS_DOMAIN>  # without https://
    letsencrypt:
      contactEmail: <HEXA_NOTEBOOKS_PROXY_HTTP_LETSENCRYPT_CONTACT_EMAIL>
  service:
    loadBalancerIP: <HEXA_NOTEBOOKS_PROXY_SERVICE_LOAD_BALANCER_IP>

hub:
  # https://zero-to-jupyterhub.readthedocs.io/en/stable/resources/reference.html#hub-cookiesecret
  cookieSecret: <HEXA_NOTEBOOKS_HUB_COOKIE_SECRET>
  # see https://zero-to-jupyterhub.readthedocs.io/en/latest/reference/reference.html?highlight=database#hub-db
  # (this is the "hub" database described in the README)
  db:
    type: postgres
    url: postgresql://<HEXA_NOTEBOOKS_HUB_DB_USER>:<HEXA_NOTEBOOKS_HUB_DB_PASSWORD>@127.0.0.1:5432/<HEXA_NOTEBOOKS_HUB_DB_DATABASE_NAME>
  extraConfig:
    00-jupyterlab-system-monitor: |
      c.Spawner.args = [
        "--ResourceUseDisplay.track_cpu_percent=True"
      ]
  extraContainers:
    - name: cloudsql-proxy
      image: gcr.io/cloudsql-docker/gce-proxy:1.21.0
      command: [ "/cloud_sql_proxy", "--dir=/cloudsql",
                 "-instances=<HEXA_CLOUDSQL_CONNECTION_STRING>=tcp:5432",
                 "-credential_file=/secrets/cloudsql/credentials.json" ]
      volumeMounts:
        - name: cloudsql-oauth-credentials
          mountPath: /secrets/cloudsql
          readOnly: true
        - name: ssl-certs
          mountPath: /etc/ssl/certs
        - name: cloudsql
          mountPath: /cloudsql
  extraEnv:
    APP_URL: https://<HEXA_APP_DOMAIN>
    APP_CREDENTIALS_URL: https://<HEXA_APP_DOMAIN>/notebooks/credentials/
  extraVolumes:
    - name: cloudsql-oauth-credentials
      secret:
        secretName: hexa-cloudsql-oauth-credentials
    - name: ssl-certs
      hostPath:
        path: /etc/ssl/certs
    - name: cloudsql
      emptyDir: { }
  extraFiles:
    # Files in /usr/local/etc/jupyterhub/jupyterhub_config.d are
    # automatically loaded in alphabetical order of the final file
    # name when JupyterHub starts.
    jupyterhub_config:
      mountPath: /usr/local/etc/jupyterhub/jupyterhub_config.d/jupyterhub_config.py
singleuser:
  # see https://zero-to-jupyterhub.readthedocs.io/en/latest/customizing/user-environment.html#customize-an-existing-docker-image
  # see https://zero-to-jupyterhub.readthedocs.io/en/latest/reference/reference.html#singleuser-image
  image:
    name: <HEXA_NOTEBOOKS_IMAGE_NAME>
    tag: <HEXA_NOTEBOOKS_IMAGE_TAG>
  defaultUrl: "/lab"
  lifecycleHooks:
    postStart:
      exec:
        command:
          - "sh"
          - "-c"
          - >
            cp -r /tmp/habari_sample_files/* /home/jovyan/;
            mkdir -p /home/jovyan/work;
  # see https://zero-to-jupyterhub.readthedocs.io/en/latest/administrator/optimization.html#optimizations
  # and https://zero-to-jupyterhub.readthedocs.io/en/latest/customizing/user-resources.html#set-user-memory-and-cpu-guarantees-limits
  cpu:
    limit: 4
    guarantee: 0.05
  memory:
    limit: 32G
    guarantee: 512M

scheduling:
  # see https://zero-to-jupyterhub.readthedocs.io/en/latest/administrator/optimization.html#optimizations
  userScheduler:
    enabled: true
  podPriority:
    enabled: true
  userPlaceholder:
    enabled: true
    replicas: 4
  userPods:
    nodeAffinity:
      matchNodePurpose: require

cull:
  enabled: true
  timeout: 3600
  every: 300